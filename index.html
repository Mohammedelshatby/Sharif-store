<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ù„Ù„Ù…Ø®Ø§Ø²Ù† - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙØ¹Ù„Ø©</title>
    <style>
        :root { --main: #1e293b; --accent: #2563eb; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; direction: rtl; text-align: right; }
        .container { max-width: 1000px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header { background: var(--main); color: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; color: white; transition: 0.3s; }
        .btn-blue { background: var(--accent); }
        .btn-green { background: #10b981; width: 100%; }
        .btn-red { background: #ef4444; }
        .admin-section { display: none; margin-top: 15px; border-top: 2px dashed #ccc; padding-top: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: center; }
        th { background: #f1f5f9; color: var(--main); }
        .no-print { display: block; }
        @media print { .no-print { display: none !important; } .print-area { display: block !important; } }
        .print-area { display: none; }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="header">
        <div>
            <h1 style="margin:0;">Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
            <p id="userLabel" style="margin:5px 0 0 0; color:#cbd5e1;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</p>
        </div>
        <div id="authArea">
            <button class="btn-blue" id="loginBtn" onclick="runLogin()">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button class="btn-red" id="logoutBtn" style="display:none;" onclick="clearAllData()">Ø®Ø±ÙˆØ¬ ÙˆØªØµÙÙŠØ±</button>
        </div>
    </div>

    <div id="adminPanel" class="admin-section">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
            <div class="card">
                <h3>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
                <input type="text" id="itN" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                <input type="text" id="itC" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
                <button class="btn-green" onclick="addItem()">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
            </div>
            <div class="card">
                <h3>ğŸ‘¥ Ù…ÙˆØ¸ÙÙŠÙ† / Ø¬Ù‡Ø§Øª</h3>
                <input type="text" id="stU" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
                <input type="text" id="stP" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button class="btn-blue" style="width:100%" onclick="addStaff()">Ø­ÙØ¸ Ù…ÙˆØ¸Ù</button>
                <hr>
                <input type="text" id="enN" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯">
                <button class="btn-green" onclick="addEntity()" style="background:#6366f1;">Ø­ÙØ¸ Ø§Ù„Ø¬Ù‡Ø©</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ”ƒ ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø®Ø²Ù†</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <select id="selIt"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option></select>
            <input type="text" id="doc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†">
            <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <select id="selEn"><option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option></select>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button onclick="logMove('ÙˆØ§Ø±Ø¯')" style="flex:1; background:#10b981;">ÙˆØ§Ø±Ø¯ (+)</button>
            <button onclick="logMove('ØµØ±Ù')" style="flex:1; background:#ef4444;">ØµØ±Ù (-)</button>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>ğŸ“Š Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
            <input type="text" id="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." onkeyup="ui()" style="width:200px;">
        </div>
        <table>
            <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø£Ø¯ÙˆØ§Øª</th></tr></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<div id="pArea" class="print-area"></div>

<script>
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
    let db = JSON.parse(localStorage.getItem('SHARIF_V7_FINAL')) || { 
        items:[], logs:[], staff:[], entities:[], pass:"123" 
    };
    let user = null;

    // Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
    function runLogin() {
        let u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
        let p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        
        if (u === "admin" && p === db.pass) {
            user = { name: "Ø§Ù„Ù…Ø¯ÙŠØ±", role: "admin" };
        } else {
            let s = db.staff.find(x => x.u === u && x.p === p);
            if (s) user = { name: u, role: "staff" };
        }

        if (user) {
            document.getElementById('loginBtn').style.display = "none";
            document.getElementById('logoutBtn').style.display = "block";
            document.getElementById('userLabel').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + user.name;
            if (user.role === "admin") document.getElementById('adminPanel').style.display = "block";
            ui();
        } else {
            alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙ„Ø·! (Admin Ùˆ 123 Ù„Ù„Ù…Ø¯ÙŠØ±)");
        }
    }

    function ui() {
        localStorage.setItem('SHARIF_V7_FINAL', JSON.stringify(db));
        let q = document.getElementById('search').value.toLowerCase();
        
        document.getElementById('selIt').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option>' + db.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        document.getElementById('selEn').innerHTML = '<option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option>' + db.entities.map(e => <option value="${e.n}">${e.n}</option>).join('');
        
        let h = "";
        db.items.forEach((it, idx) => {
            if(it.n.toLowerCase().includes(q) || it.c.toLowerCase().includes(q)) {
                let bal = 0; db.logs.forEach(l => { if(l.c==it.c) bal += (l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); });
                h += `<tr><td>${it.c}</td><td><b>${it.n}</b></td><td>${bal}</td>
                <td><button onclick="pCard('${it.c}')" style="background:#2563eb; padding:5px 10px;">ÙƒØ§Ø±ØªØ©</button>
                ${user?.role=='admin'?<button onclick="delI(${idx})" style="background:none; color:red;">ğŸ—‘</button>:''}</td></tr>`;
            }
        });
        document.getElementById('tbody').innerHTML = h;
    }

    function logMove(t) {
        if(!user) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!");
        let c=document.getElementById('selIt').value, q=parseFloat(document.getElementById('qty').value), d=document.getElementById('doc').value, e=document.getElementById('selEn').value;
        if(c && q && d) { db.logs.push({c,q,t,d,e,u:user.name, dt:new Date().toLocaleString()}); ui(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); }
        else alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    }

    function addItem() { let n=document.getElementById('itN').value, c=document.getElementById('itC').value; if(n&&c){db.items.push({n,c}); ui(); alert("ØªÙ…");} }
    function addStaff() { let u=document.getElementById('stU').value, p=document.getElementById('stP').value; if(u&&p){db.staff.push({u,p}); ui(); alert("ØªÙ…");} }
    function addEntity() { let n=document.getElementById('enN').value; if(n){db.entities.push({n}); ui(); alert("ØªÙ…");} }
    function delI(i) { if(confirm("Ø­Ø°ÙØŸ")){db.items.splice(i,1); ui();} }
    function clearAllData() { if(confirm("Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ")){ localStorage.removeItem('SHARIF_V7_FINAL'); location.reload(); } }

    function pCard(code) {
        let it = db.items.find(x=>x.c==code);
        let logs = db.logs.filter(l=>l.c==code);
        let h = `<div style="direction:rtl; padding:20px;"><h2>ÙƒØ§Ø±ØªØ© ØµÙ†Ù: ${it.n}</h2><table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
        <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø°Ù†</th><th>Ø¨ÙˆØ§Ø³Ø·Ø©</th></tr></thead><tbody>`;
        let b=0; logs.forEach(l=>{ b+=(l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); h+=<tr><td>${l.dt}</td><td>${l.t}</td><td>${l.q}</td><td>${l.d}</td><td>${l.u}</td></tr>; });
        h += </tbody></table><h3>Ø§Ù„Ø±ØµÙŠØ¯: ${b}</h3></div>;
        document.getElementById('pArea').innerHTML = h; window.print();
    }
    ui();
</script>
</body>
</html>
