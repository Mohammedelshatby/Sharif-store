<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ - Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ V18</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background: #000; color: #d4af37; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 10px; }
        .box { border: 2px solid #d4af37; padding: 15px; margin-bottom: 15px; background: #111; border-radius: 10px; }
        .btn-gold { 
            background: #d4af37; color: #000; padding: 12px; 
            border: none; border-radius: 5px; font-weight: bold; 
            font-size: 16px; cursor: pointer; margin: 5px; width: 45%; max-width: 200px;
        }
        .modal { display:none; position:fixed; top:2%; left:2%; width:96%; height:96%; background:#1a1a1a; border:3px solid #d4af37; z-index:99999; padding:15px; overflow-y:auto; border-radius: 15px; box-sizing: border-box; }
        input, select { width: 90%; padding: 10px; margin: 8px 0; background: #000; color: #fff; border: 1px solid #d4af37; border-radius: 5px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; color: #fff; font-size: 14px; }
        th, td { border: 1px solid #d4af37; padding: 8px; text-align: center; }
        .admin-badge { background: red; color: white; padding: 5px 10px; border-radius: 5px; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h1 id="title">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
    <div id="adminBadge" class="admin-badge">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± - ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©</div>
    <p id="userDisplay">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: Ù…ÙˆØ¸Ù</p>
    <button id="switchBtn" class="btn-gold" style="background:#555; color:white; width:150px" onclick="loginSystem()">ğŸ”‘ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
    <button id="logoutBtn" class="btn-gold" style="background:red; color:white; width:150px; display:none;" onclick="logout()">ğŸšª ØªØ¨Ø¯ÙŠÙ„ Ù„Ù…ÙˆØ¸Ù</button>
</div>

<div class="box">
    <button class="btn-gold" onclick="document.getElementById('m_it').style.display='block'">ğŸ“¦ ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù</button>
    <button class="btn-gold" onclick="openAction('ÙˆØ§Ø±Ø¯')">ğŸ“¥ Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ©</button>
    <button class="btn-gold" onclick="openAction('ØµØ±Ù')">ğŸ“¤ Ø¥Ø°Ù† ØµØ±Ù</button>
    <button class="btn-gold" onclick="showInventory()">ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†</button>
    <button id="masterBtn" class="btn-gold" style="display:none; background:white; color:black;" onclick="document.getElementById('admin_panel').style.display='block'; renderAdminLogs(); renderItemsControl();">âš™ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
</div>

<div id="admin_panel" class="modal">
    <h2 style="color:#d4af37">âš™ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
    <div class="box">
        <h3>ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
        <div id="items_control_view"></div>
    </div>
    <div class="box">
        <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="staff_u" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
        <input type="password" id="staff_p" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-gold" onclick="addStaff()">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</button>
    </div>
    <div class="box">
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…</h3>
        <button class="btn-gold" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³ÙŠÙ„</button>
        <div id="logs_view"></div>
    </div>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_it" class="modal">
    <h2>ğŸ“¦ ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="it_n" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
    <input type="text" id="it_c" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
    <button class="btn-gold" onclick="saveItem()">Ø­ÙØ¸</button>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_edit_it" class="modal">
    <h2>âœ ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù</h2>
    <input type="hidden" id="edit_old_c">
    <input type="text" id="edit_it_n" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯">
    <input type="text" id="edit_it_c" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯">
    <button class="btn-gold" onclick="updateItem()">ØªØ­Ø¯ÙŠØ«</button>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<div id="m_act" class="modal">
    <h2 id="act_title">Ø­Ø±ÙƒØ©</h2>
    <input type="text" id="doc_no" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù† ÙŠØ¯ÙˆÙŠ">
    <select id="sel_act"></select>
    <input type="number" id="qty_act" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <input type="text" id="cl_act" placeholder="Ø§Ù„Ø¬Ù‡Ø©">
    <button class="btn-gold" onclick="saveLog()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_inv" class="modal">
    <h2>ğŸ“Š Ø§Ù„Ø¬Ø±Ø¯</h2>
    <input type="text" id="search_it" placeholder="Ø¨Ø­Ø« Ø¨ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ø³Ù…..." onkeyup="filterInv()">
    <div id="inv_table"></div>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
    var db = JSON.parse(localStorage.getItem('SHARIF_V18')) || { 
        name: "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ", 
        items: [], 
        logs: [], 
        staff: [{u: "admin", p: "2525"}] 
    };
    var current_user = "Ù…ÙˆØ¸Ù";
    var is_admin = false;

    function loginSystem() {
        var u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
        var p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        var found = db.staff.find(x => x.u === u && x.p === p);
        if(found) {
            current_user = u;
            is_admin = true;
            document.getElementById('userDisplay').innerText = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + u;
            document.getElementById('adminBadge').style.display = 'block';
            document.getElementById('masterBtn').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'inline-block';
            document.getElementById('switchBtn').style.display = 'none';
            alert("ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±");
        } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!"); }
    }

    function logout() {
        is_admin = false;
        current_user = "Ù…ÙˆØ¸Ù";
        document.getElementById('userDisplay').innerText = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ù…ÙˆØ¸Ù";
        document.getElementById('adminBadge').style.display = 'none';
        document.getElementById('masterBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('switchBtn').style.display = 'inline-block';
    }

    function renderItemsControl() {
        var h = '<table><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>';
        db.items.forEach(function(i){
            h += `<tr><td>${i.c}</td><td>${i.n}</td>
            <td><button onclick="editItemForm('${i.c}','${i.n}')" style="background:orange; border:none; padding:5px; cursor:pointer">âœ</button></td>
            <td><button onclick="deleteItem('${i.c}')" style="background:red; color:white; border:none; padding:5px; cursor:pointer">ğŸ—‘</button></td></tr>`;
        });
        document.getElementById('items_control_view').innerHTML = h + '</table>';
    }

    function editItemForm(oldC, oldN) {
        document.getElementById('edit_old_c').value = oldC;
        document.getElementById('edit_it_n').value = oldN;
        document.getElementById('edit_it_c').value = oldC;
        document.getElementById('m_edit_it').style.display = 'block';
    }

    function updateItem() {
        var oldC = document.getElementById('edit_old_c').value;
        var newN = document.getElementById('edit_it_n').value;
        var newC = document.getElementById('edit_it_c').value;
        
        var it = db.items.find(x => x.c === oldC);
        if(it) {
            it.n = newN; it.c = newC;
            db.logs.forEach(l => { if(l.c === oldC) l.c = newC; });
            saveDB(); renderItemsControl();
            document.getElementById('m_edit_it').style.display = 'none';
            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ù ÙˆØ³Ø¬Ù„Ø§ØªÙ‡");
        }
    }

    function deleteItem(code) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØµÙ†Ù ØªÙ…Ø§Ù…Ø§Ù‹ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§ØªÙ‡ Ø£ÙŠØ¶Ø§Ù‹!")) {
            db.items = db.items.filter(x => x.c !== code);
            db.logs = db.logs.filter(x => x.c !== code);
            saveDB(); renderItemsControl();
        }
    }

    function saveItem() {
        var n = document.getElementById('it_n').value, c = document.getElementById('it_c').value;
        if(n && c) {
            db.items.push({n:n, c:c});
            saveDB(); alert("ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯");
            document.getElementById('m_it').style.display='none';
        }
    }

    function openAction(type) {
        document.getElementById('act_title').innerText = "Ø¥Ø°Ù† " + type;
        var s = document.getElementById('sel_act');
        s.innerHTML = db.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        document.getElementById('m_act').style.display='block';
        window.currentActionType = type;
    }

    function saveLog() {
        var d = document.getElementById('doc_no').value;
        var c = document.getElementById('sel_act').value;
        var q = document.getElementById('qty_act').value;
        var cl = document.getElementById('cl_act').value;
        if(d && c && q) {
            db.logs.push({id:Date.now(), doc:d, c:c, q:parseFloat(q), t:window.currentActionType, cl:cl, u:current_user, dt:new Date().toLocaleString()});
            saveDB(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
            document.getElementById('m_act').style.display='none';
        }
    }

    function showInventory() {
        renderInvTable(db.items);
        document.getElementById('m_inv').style.display='block';
    }

    function renderInvTable(itemsList) {
        var h = '<table><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr>';
        itemsList.forEach(function(i){
            var b = 0;
            db.logs.forEach(function(l){ if(l.c==i.c) b += (l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); });
            h += <tr><td>${i.c}</td><td>${i.n}</td><td>${b}</td></tr>;
        });
        document.getElementById('inv_table').innerHTML = h + '</table>';
    }

    function renderAdminLogs() {
        var h = '<table><tr><th>Ø¥Ø°Ù†</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø­Ø°Ù</th></tr>';
        db.logs.forEach(function(l){
            h += <tr><td>${l.doc}</td><td>${l.t}</td><td>${l.c}</td><td><button onclick="delLog(${l.id})" style="color:red">X</button></td></tr>;
        });
        document.getElementById('logs_view').innerHTML = h + '</table>';
    }

    function delLog(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ")) { db.logs = db.logs.filter(x => x.id !== id); saveDB(); renderAdminLogs(); }
    }

    function addStaff() {
        var u = document.getElementById('staff_u').value, p = document.getElementById('staff_p').value;
        if(u && p) { db.staff.push({u:u, p:p}); saveDB(); alert("ØªÙ…Â Ø§Ù„Ø­ÙØ¸");Â }
