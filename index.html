<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ - V20</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background: #000; color: #d4af37; font-family: sans-serif; text-align: center; margin: 0; padding: 10px; }
        .box { border: 2px solid #d4af37; padding: 15px; background: #111; border-radius: 10px; margin-bottom: 10px; }
        .btn { 
            background: #d4af37; color: #000; padding: 18px; 
            border: 2px solid #fff; border-radius: 10px; font-weight: bold; 
            font-size: 20px; cursor: pointer; margin: 8px; width: 95%; max-width: 350px;
            display: inline-block; -webkit-appearance: none;
        }
        .btn:active { background: #fff; transform: scale(0.98); }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:99999; padding-top: 20px; overflow-y:auto; }
        input, select { width: 90%; padding: 15px; margin: 10px 0; background: #222; color: #fff; border: 1px solid #d4af37; font-size: 18px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; color: #fff; margin-top: 10px; }
        th, td { border: 1px solid #d4af37; padding: 12px; text-align: center; }
        .admin-zone { display: none; border: 3px dashed red; padding: 15px; margin-top: 15px; background: #0a0a0a; }
    </style>
</head>
<body>

<div class="box">
    <h1 id="title">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
    <p id="userSt">Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ÙˆØ¸Ù</p>
    <button class="btn" style="background:#333; color:white; font-size:16px;" onclick="var p=prompt('Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ±:'); if(p=='2525'){ document.getElementById('adminArea').style.display='block'; document.getElementById('userSt').innerText='Ø§Ù„Ø­Ø§Ù„Ø©: Ù…Ø¯ÙŠØ±'; alert('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±'); }else{ alert('Ø®Ø·Ø£!'); }">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± (2525)</button>
    <button class="btn" style="background:#900; color:white; width:120px; font-size:14px;" onclick="location.reload()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø´ÙŠØ·</button>
</div>

<div class="box">
    <button class="btn" onclick="document.getElementById('win_item').style.display='block';">ğŸ“¦ ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</button>
    <button class="btn" onclick="activeT='ÙˆØ§Ø±Ø¯'; document.getElementById('win_move').style.display='block'; document.getElementById('move_h').innerText='Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ© (ÙˆØ§Ø±Ø¯)'; loadItems();">ğŸ“¥ Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ©</button>
    <button class="btn" onclick="activeT='ØµØ±Ù'; document.getElementById('win_move').style.display='block'; document.getElementById('move_h').innerText='Ø¥Ø°Ù† ØµØ±Ù (ØµØ§Ø¯Ø±)'; loadItems();">ğŸ“¤ Ø¥Ø°Ù† ØµØ±Ù</button>
    <button class="btn" onclick="renderInventory(); document.getElementById('win_inv').style.display='block';">ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†</button>
</div>

<div id="adminArea" class="admin-zone">
    <h2 style="color:red">âš™ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
    <button class="btn" onclick="exportData()">ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø¥ÙƒØ³ÙŠÙ„</button>
    <button class="btn" style="background:orange" onclick="showEditTools()">âœ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
    <div id="adminTools"></div>
</div>

<div id="win_item" class="modal">
    <h2>ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù</h2>
    <input type="text" id="in_name" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
    <input type="text" id="in_code" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
    <button class="btn" onclick="saveItem()">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
    <button class="btn" style="background:red; color:white;" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="win_move" class="modal">
    <h2 id="move_h">Ø­Ø±ÙƒØ©</h2>
    <input type="text" id="in_doc" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†">
    <select id="in_sel"></select>
    <input type="number" id="in_qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <input type="text" id="in_cl" placeholder="Ø§Ù„Ø¬Ù‡Ø©">
    <button class="btn" onclick="saveMove()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    <button class="btn" style="background:red; color:white;" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="win_inv" class="modal">
    <h2>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬Ø±Ø¯</h2>
    <input type="text" placeholder="Ø¨Ø­Ø«..." onkeyup="searchInv(this.value)">
    <div id="inv_table_box"></div>
    <button class="btn" style="background:red; color:white;" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
    // 1. Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
    var activeT = "";
    var store = JSON.parse(localStorage.getItem('SHARIF_MASTER_V20')) || { name:"Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ", items:[], logs:[] };
    document.getElementById('title').innerText = store.name;

    // 2. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù…Ø¨Ø§Ø´Ø±Ø©)
    function saveItem() {
        var n = document.getElementById('in_name').value;
        var c = document.getElementById('in_code').value;
        if(n && c) {
            store.items.push({n:n, c:c});
            sync(); alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
            document.getElementById('win_item').style.display='none';
        } else { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
    }

    function loadItems() {
        var s = document.getElementById('in_sel');
        s.innerHTML = store.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
    }

    function saveMove() {
        var d = document.getElementById('in_doc').value;
        var c = document.getElementById('in_sel').value;
        var q = document.getElementById('in_qty').value;
        if(d && c && q) {
            store.logs.push({id:Date.now(), doc:d, c:c, q:parseFloat(q), t:activeT, dt:new Date().toLocaleString()});
            sync(); alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©");
            document.getElementById('win_move').style.display='none';
        } else { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
    }

    function renderInventory() {
        var h = '<table><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr>';
        store.items.forEach(i => {
            var b = 0;
            store.logs.forEach(l => { if(l.c==i.c) b += (l.t=='ÙˆØ§Ø±Ø¯'? l.q : -l.q); });
            h += <tr><td>${i.n}</td><td>${b}</td></tr>;
        });
        document.getElementById('inv_table_box').innerHTML = h + '</table>';
    }

    function showEditTools() {
        var h = '<h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3><table>';
        store.items.forEach((i, idx) => {
            h += <tr><td>${i.n}</td><td><button onclick="deleteItem(${idx})" style="color:red">Ø­Ø°Ù</button></td></tr>;
        });
        document.getElementById('adminTools').innerHTML = h + '</table>';
    }

    function deleteItem(idx) {
        if(confirm("Ø­Ø°Ù Ø§Ù„ØµÙ†Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { store.items.splice(idx,1); sync(); showEditTools(); }
    }

    function sync() { localStorage.setItem('SHARIF_MASTER_V20', JSON.stringify(store)); }

    function exportData() {
        var ws = XLSX.utils.json_to_sheet(store.logs);
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Sijil");
        XLSX.writeFile(wb, "Sharif_Inventory.xlsx");
    }
</script>

</body>
</html>
