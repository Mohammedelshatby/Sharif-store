<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ù„Ù„Ù…Ø®Ø§Ø²Ù† | V5</title>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; direction: rtl; }
        .container { max-width: 1100px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header { background: var(--primary); color: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; color: white; transition: 0.3s; }
        .btn-blue { background: var(--accent); }
        .btn-green { background: #10b981; width: 100%; }
        .btn-red { background: #ef4444; }
        .admin-only { display: none; } /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: center; }
        th { background: #f1f5f9; color: var(--primary); }
        
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none !important; }
            .print-area { display: block !important; width: 100%; }
            .card { box-shadow: none; border: 1px solid #eee; }
        }
        .print-area { display: none; }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="header">
        <div>
            <h1 style="margin:0;">Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
            <p id="statusTxt" style="margin:5px 0 0 0; color:#94a3b8;">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¨Ø¯Ø¡</p>
        </div>
        <button class="btn-blue" id="loginBtn" onclick="loginSystem()">ğŸ” Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
        <button class="btn-red" id="logoutBtn" style="display:none;" onclick="location.reload()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="adminBox" class="admin-only card" style="border: 2px dashed #3b82f6;">
        <h3 style="margin-top:0; color:#3b82f6;">âš™ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <label>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù:</label>
                <input type="text" id="stU" placeholder="Ø§Ù„Ø§Ø³Ù…">
                <input type="password" id="stP" placeholder="Ø§Ù„Ø±Ù…Ø²">
                <button class="btn-green" onclick="addStaff()">Ø­ÙØ¸ Ù…ÙˆØ¸Ù</button>
            </div>
            <div>
                <label>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„/Ù…ÙˆØ±Ø¯:</label>
                <input type="text" id="enN" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                <select id="enT"><option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option><option value="Ù…ÙˆØ±Ø¯">Ù…ÙˆØ±Ø¯</option></select>
                <button class="btn-green" onclick="addEntity()" style="background:#6366f1;">Ø­ÙØ¸ Ø§Ù„Ø·Ø±Ù</button>
            </div>
            <div>
                <label>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯:</label>
                <input type="text" id="itN" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                <input type="text" id="itC" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
                <button class="btn-green" onclick="addItem()" style="background:#0f172a;">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ”ƒ ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© (ÙˆØ§Ø±Ø¯ / ØµØ±Ù)</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <select id="selIt"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option></select>
            <input type="text" id="docN" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†">
            <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <select id="selEn"><option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option></select>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button onclick="saveLog('ÙˆØ§Ø±Ø¯')" style="flex:1; background:#10b981;">ÙˆØ§Ø±Ø¯ (+)</button>
            <button onclick="saveLog('ØµØ±Ù')" style="flex:1; background:#ef4444;">ØµØ±Ù (-)</button>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
            <h3>ğŸ“Š Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
            <div style="display:flex; gap:10px;">
                <input type="text" id="search" placeholder="Ø¨Ø­Ø«..." onkeyup="ui()" style="width:200px; margin:0;">
                <button onclick="window.print()" style="background:#64748b;">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø±Ø¯</button>
            </div>
        </div>
        <table>
            <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø£Ø¯ÙˆØ§Øª</th></tr></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<div id="pView" class="print-area"></div>

<script>
    let db = JSON.parse(localStorage.getItem('SHARIF_V5')) || { items:[], logs:[], staff:[], entities:[], pass:"123" };
    let user = null;

    function loginSystem() {
        let u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (admin Ù„Ù„Ù…Ø¯ÙŠØ±):");
        let p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        if(u === "admin" && p === db.pass) { user = {n:"Ø§Ù„Ù…Ø¯ÙŠØ±", r:"admin"}; }
        else { let s = db.staff.find(x => x.u === u && x.p === p); if(s) user = {n:u, r:"staff"}; }

        if(user) {
            document.getElementById('loginBtn').style.display="none";
            document.getElementById('logoutBtn').style.display="inline-block";
            document.getElementById('statusTxt').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + user.n;
            document.getElementById('statusTxt').style.color = "#10b981";
            if(user.r === "admin") document.getElementById('adminBox').style.display="block";
            ui();
        } else { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!"); }
    }

    function ui() {
        localStorage.setItem('SHARIF_V5', JSON.stringify(db));
        let q = document.getElementById('search').value.toLowerCase();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        document.getElementById('selIt').innerHTML = '<option value="">-- Ø§Ø®ØªØ± ØµÙ†Ù --</option>' + db.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        document.getElementById('selEn').innerHTML = '<option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option>' + db.entities.map(e => <option value="${e.n}">${e.n}</option>).join('');

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
        let h = "";
        db.items.forEach((it, idx) => {
            if(it.n.toLowerCase().includes(q) || it.c.toLowerCase().includes(q)) {
                let bal = 0; db.logs.forEach(l => { if(l.c==it.c) bal += (l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); });
                h += `<tr><td>${it.c}</td><td><b>${it.n}</b></td><td>${bal}</td>
                <td><button onclick="printCard('${it.c}')" style="background:#3b82f6; padding:5px 10px;">ÙƒØ§Ø±ØªØ©</button>
                ${user?.r=='admin'?<button onclick="delI(${idx})" style="color:red; background:none;">ğŸ—‘</button>:''}</td></tr>`;
            }
        });
        document.getElementById('tbody').innerHTML = h;
    }

    function saveLog(t) {
        if(!user) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        let c=document.getElementById('selIt').value, q=parseFloat(document.getElementById('qty').value), d=document.getElementById('docN').value, e=document.getElementById('selEn').value;
        if(c && q && d) { db.logs.push({c,q,t,d,e,u:user.n, dt:new Date().toLocaleString()}); ui(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); }
        else { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
    }

    function addItem() { let n=document.getElementById('itN').value, c=document.getElementById('itC').value; if(n&&c){db.items.push({n,c}); ui(); alert("ØªÙ…");} }
    function addStaff() { let u=document.getElementById('stU').value, p=document.getElementById('stP').value; if(u&&p){db.staff.push({u,p}); ui(); alert("ØªÙ…");} }
    function addEntity() { let n=document.getElementById('enN').value, t=document.getElementById('enT').value; if(n){db.entities.push({n,t}); ui(); alert("ØªÙ…");} }
    function delI(i) { if(confirm("Ø­Ø°ÙØŸ")){db.items.splice(i,1); ui();} }

    function printCard(code) {
        let it = db.items.find(x=>x.c==code);
        let logs = db.logs.filter(l=>l.c==code);
        let h = `<div style="direction:rtl; padding:20px;"><h2>ÙƒØ§Ø±ØªØ© ØµÙ†Ù: ${it.n} (${code})</h2><table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
        <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th></tr></thead><tbody>`;
        let b=0; logs.forEach(l=>{ b+=(l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); h+=<tr><td>${l.dt}</td><td>${l.t}</td><td>${l.q}</td><td>${l.d}</td><td>${l.u}</td></tr>; });
        h += </tbody></table><h3>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${b}</h3></div>;
        document.getElementById('pView').innerHTML = h; window.print();
    }
    ui();
</script>
</body>
</html>
