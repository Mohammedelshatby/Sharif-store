<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background: #000; color: #d4af37; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 10px; }
        .box { border: 2px solid #d4af37; padding: 15px; margin-bottom: 15px; background: #111; border-radius: 10px; }
        .btn-gold { 
            background: #d4af37; color: #000; padding: 12px; 
            border: none; border-radius: 5px; font-weight: bold; 
            font-size: 16px; cursor: pointer; margin: 5px; width: 45%; max-width: 200px;
        }
        .modal { display:none; position:fixed; top:2%; left:2%; width:96%; height:96%; background:#1a1a1a; border:3px solid #d4af37; z-index:99999; padding:15px; overflow-y:auto; border-radius: 15px; box-sizing: border-box; }
        input, select { width: 90%; padding: 10px; margin: 8px 0; background: #000; color: #fff; border: 1px solid #d4af37; border-radius: 5px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; color: #fff; font-size: 14px; }
        th, td { border: 1px solid #d4af37; padding: 8px; text-align: center; }
        .print-only { display: none; }
        @media print { body * { visibility: hidden; } .print-area, .print-area * { visibility: visible; } .print-area { position: absolute; left: 0; top: 0; width: 100%; } }
    </style>
</head>
<body>

<div class="box">
    <h1 id="title">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
    <p id="userDisplay">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: Ø²Ø§Ø¦Ø±</p>
</div>

<div class="box">
    <button class="btn-gold" onclick="document.getElementById('m_it').style.display='block'">ğŸ“¦ ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù</button>
    <button class="btn-gold" onclick="openAction('ÙˆØ§Ø±Ø¯')">ğŸ“¥ Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ©</button>
    <button class="btn-gold" onclick="openAction('ØµØ±Ù')">ğŸ“¤ Ø¥Ø°Ù† ØµØ±Ù</button>
    <button class="btn-gold" onclick="showInventory()">ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†</button>
    <button class="btn-gold" style="background:#555; color:#fff;" onclick="checkAdmin()">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</button>
</div>

<div id="admin_panel" class="modal">
    <h2 style="color:var(--gold)">âš™ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h2>
    <div class="box">
        <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
        <input type="text" id="staff_u" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
        <input type="password" id="staff_p" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-gold" onclick="addStaff()">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</button>
    </div>
    <div class="box">
        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©</h3>
        <input type="text" id="new_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        <button class="btn-gold" onclick="updateTitle()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…</button>
    </div>
    <h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…</h3>
    <button class="btn-gold" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„ Ù„Ø¥ÙƒØ³ÙŠÙ„</button>
    <div id="logs_view"></div>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_it" class="modal">
    <h2>ğŸ“¦ ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="it_n" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
    <input type="text" id="it_c" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
    <button class="btn-gold" onclick="saveItem()">Ø­ÙØ¸</button>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_act" class="modal">
    <h2 id="act_title">Ø­Ø±ÙƒØ©</h2>
    <input type="text" id="doc_no" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù† ÙŠØ¯ÙˆÙŠ">
    <select id="sel_act"></select>
    <input type="number" id="qty_act" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <input type="text" id="cl_act" placeholder="Ø§Ù„Ø¬Ù‡Ø© (Ù…ÙˆØ±Ø¯/Ø¹Ù…ÙŠÙ„)">
    <button class="btn-gold" onclick="saveLog()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m_inv" class="modal">
    <h2>ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø§Ø²Ù† ÙˆØ§Ù„Ø¨Ø­Ø«</h2>
    <input type="text" id="search_it" placeholder="Ø¨Ø­Ø« Ø¨ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù..." onkeyup="filterInv()">
    <button class="btn-gold" onclick="printDiv('inv_area')">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø±Ø¯</button>
    <div id="inv_area" class="print-area">
        <div id="inv_table"></div>
    </div>
    <button class="btn-gold" style="background:red" onclick="this.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
    var db = JSON.parse(localStorage.getItem('SHARIF_V17')) || { 
        name: "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ", 
        items: [], 
        logs: [], 
        staff: [{u: "admin", p: "2525"}] 
    };
    var current_user = "admin";
    var active_type = "";

    document.getElementById('title').innerText = db.name;

    function checkAdmin() {
        var u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
        var p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        var found = db.staff.find(x => x.u === u && x.p === p);
        if(found) {
            current_user = u;
            document.getElementById('userDisplay').innerText = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + u;
            document.getElementById('admin_panel').style.display='block';
            renderAdminLogs();
        } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!"); }
    }

    function addStaff() {
        var u = document.getElementById('staff_u').value;
        var p = document.getElementById('staff_p').value;
        if(u && p) {
            db.staff.push({u:u, p:p});
            saveDB(); alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù");
        }
    }

    function saveItem() {
        var n = document.getElementById('it_n').value, c = document.getElementById('it_c').value;
        if(n && c) {
            db.items.push({n:n, c:c});
            saveDB(); alert("ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠØ¯");
            document.getElementById('m_it').style.display='none';
        }
    }

    function openAction(type) {
        active_type = type;
        document.getElementById('act_title').innerText = "Ø¥Ø°Ù† " + type;
        var s = document.getElementById('sel_act');
        s.innerHTML = db.items.map(i => '<option value="'+i.c+'">'+i.n+' ['+i.c+']</option>').join('');
        document.getElementById('m_act').style.display='block';
    }

    function saveLog() {
        var d = document.getElementById('doc_no').value;
        var c = document.getElementById('sel_act').value;
        var q = document.getElementById('qty_act').value;
        var cl = document.getElementById('cl_act').value;
        if(d && c && q) {
            db.logs.push({id:Date.now(), doc:d, c:c, q:parseFloat(q), t:active_type, cl:cl, u:current_user, dt:new Date().toLocaleString()});
            saveDB(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
            document.getElementById('m_act').style.display='none';
        } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù† ÙˆØ§Ù„ÙƒÙ…ÙŠØ©"); }
    }

    function showInventory() {
        renderInvTable(db.items);
        document.getElementById('m_inv').style.display='block';
    }

    function renderInvTable(itemsList) {
        var h = '<table><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr>';
        itemsList.forEach(function(i){
            var b = 0;
            db.logs.forEach(function(l){ if(l.c==i.c) b += (l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); });
            h += '<tr><td>'+i.c+'</td><td>'+i.n+'</td><td>'+b+'</td></tr>';
        });
        document.getElementById('inv_table').innerHTML = h + '</table>';
    }

    function filterInv() {
        var val = document.getElementById('search_it').value.toLowerCase();
        var filtered = db.items.filter(i => i.c.toLowerCase().includes(val) || i.n.toLowerCase().includes(val));
        renderInvTable(filtered);
    }

    function renderAdminLogs() {
        var h = '<table><tr><th>Ø¥Ø°Ù†</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø­Ø°Ù</th></tr>';
        db.logs.forEach(function(l){
            var it = db.items.find(x => x.c == l.c);
            h += '<tr><td>'+l.doc+'</td><td>'+l.dt+'</td><td>'+l.t+'</td><td>'+(it?it.n:l.c)+'</td><td>'+l.q+'</td><td><button onclick="delLog('+l.id+')" style="color:red">X</button></td></tr>';
        });
        document.getElementById('logs_view').innerHTML = h + '</table>';
    }

    function delLog(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ")) { db.logs = db.logs.filter(x => x.id !== id); saveDB(); renderAdminLogs(); }
    }

    function updateTitle() {
        var v = document.getElementById('new_name').value;
        if(v) { db.name = v; document.getElementById('title').innerText = v; saveDB(); }
    }

    function saveDB() { localStorage.setItem('SHARIF_V17', JSON.stringify(db)); }

    function printDiv(id) {
        window.print();
    }

    function exportToExcel() {
        var ws = XLSX.utils.json_to_sheet(db.logs);
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Logs");
        XLSX.writeFile(wb, "Sharif_Inventory_Report.xlsx");
    }
</script>

</body>
</html>
