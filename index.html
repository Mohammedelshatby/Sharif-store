<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ</title>
    <style>
        :root { 
            --gold: #c5a059; --dark: #1a2a3a; --bg: #f4f7f6; --white: #ffffff; 
            --danger: #9d2d2d; --success: #2d5a27;
        }
        body { font-family: 'Times New Roman', serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; color: var(--dark); }
        .no-print { padding: 20px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙØ§Ø®Ø± */
        header { 
            background: var(--dark); color: var(--gold); padding: 30px; 
            border-bottom: 5px solid var(--gold); border-radius: 0 0 20px 20px;
            display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginOverlay { 
            background: white; padding: 40px; border-radius: 15px; border: 2px solid var(--gold);
            max-width: 400px; margin: 50px auto; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        /* Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„Ù‚ÙˆØ§Ù„Ø¨ */
        .card { background: var(--white); border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 1px solid #e0e0e0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h2, h3 { border-right: 5px solid var(--gold); padding-right: 15px; color: var(--dark); }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ§Ø®Ø±Ø© */
        button { 
            padding: 12px 25px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold;
            text-transform: uppercase; transition: all 0.3s; margin: 5px;
        }
        .btn-gold { background: var(--gold); color: var(--dark); }
        .btn-gold:hover { background: var(--dark); color: var(--gold); border: 1px solid var(--gold); }
        .btn-dark { background: var(--dark); color: var(--gold); }
        .btn-red { background: var(--danger); color: white; }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        input, select { 
            padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; 
            width: 100%; box-sizing: border-box; font-size: 16px;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th { background: var(--dark); color: var(--gold); padding: 15px; }
        td { border: 1px solid #ddd; padding: 12px; text-align: center; font-weight: bold; }
        tr:nth-child(even) { background: #fafafa; }

        .admin-section { display: none; }

        /* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .no-print { display: none !important; }
            .print-area { display: block !important; width: 100%; }
            table { border: 1px solid #000; }
        }
        .print-area { display: none; }
    </style>
</head>
<body>

<div id="loginPage" class="no-print">
    <div id="loginOverlay">
        <h1 style="color: var(--dark);">Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ</h1>
        <p style="color: var(--gold);">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
        <input type="text" id="userIn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="passIn" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-gold" style="width: 100%;" onclick="attemptLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>
</div>

<div id="mainContent" style="display:none;">
    <header class="no-print">
        <div>
            <h1 style="margin:0;">Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
            <span id="userNameDisplay" style="color: white; font-style: italic;"></span>
        </div>
        <button class="btn-red" onclick="location.reload()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </header>

    <div class="container no-print">
        <div id="adminArea" class="admin-section card">
            <h3>âš™ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ… (Ù…Ø¯ÙŠØ±)</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div>
                    <label>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù:</label>
                    <input type="text" id="newStaffU" placeholder="Ø§Ù„Ø§Ø³Ù…">
                    <input type="text" id="newStaffP" placeholder="Ø§Ù„Ø±Ù…Ø²">
                    <button class="btn-dark" onclick="addStaff()">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</button>
                </div>
                <div>
                    <label>Ø¥Ø¶Ø§ÙØ© Ø·Ø±Ù (Ø¹Ù…ÙŠÙ„/Ù…ÙˆØ±Ø¯):</label>
                    <input type="text" id="entName" placeholder="Ø§Ù„Ø§Ø³Ù…">
                    <select id="entType"><option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option><option value="Ù…ÙˆØ±Ø¯">Ù…ÙˆØ±Ø¯</option></select>
                    <button class="btn-dark" onclick="addEntity()">Ø­ÙØ¸ Ø§Ù„Ø·Ø±Ù</button>
                </div>
                <div>
                    <label>ØªØ¹Ø±ÙŠÙ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯:</label>
                    <input type="text" id="itName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                    <input type="text" id="itCode" placeholder="Ø§Ù„ÙƒÙˆØ¯">
                    <button class="btn-gold" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ”ƒ Ø­Ø±ÙƒØ© Ø§Ù„ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„ØµØ±Ù</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <select id="selectItem"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option></select>
                <input type="text" id="docNum" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†">
                <input type="number" id="docQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                <select id="selectEnt"><option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option></select>
            </div>
            <div style="margin-top:20px; display: flex; gap:15px;">
                <button class="btn-gold" style="flex:1; background:#2d5a27; color:white;" onclick="process(1)">ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ø±Ø¯ (+)</button>
                <button class="btn-gold" style="flex:1; background:#9d2d2d; color:white;" onclick="process(0)">ØªØ³Ø¬ÙŠÙ„ ØµØ±Ù (-)</button>
            </div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ğŸ“Š Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="searchBar" placeholder="Ø¨Ø­Ø«..." onkeyup="renderUI()" style="width:200px; margin:0;">
                    <button class="btn-dark" onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø±Ø¯</button>
                </div>
            </div>
            <table>
                <thead>
                    <tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø§Ù„ØªØ­ÙƒÙ…</th></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="printZone" class="print-area"></div>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let system = JSON.parse(localStorage.getItem('SHARIF_PRO_V9')) || {
        items: [], logs: [], staff: [], entities: [], adminKey: "123"
    };
    let activeUser = null;

    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
    function attemptLogin() {
        let u = document.getElementById('userIn').value;
        let p = document.getElementById('passIn').value;

        if (u === "admin" && p === system.adminKey) {
            activeUser = { name: "Ø§Ù„Ù…Ø¯ÙŠØ±", role: "admin" };
        } else {
            let s = system.staff.find(x => x.u === u && x.p === p);
            if (s) activeUser = { name: u, role: "staff" };
        }

        if (activeUser) {
            document.getElementById('loginPage').style.display = "none";
            document.getElementById('mainContent').style.display = "block";
            document.getElementById('userNameDisplay').innerText = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: " + activeUser.name;
            if (activeUser.role === "admin") {
                document.getElementById('adminArea').style.display = "block";
            }
            renderUI();
        } else {
            alert("âš  Ø®Ø·Ø£ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
        }
    }

    function renderUI() {
        localStorage.setItem('SHARIF_PRO_V9', JSON.stringify(system));
        let search = document.getElementById('searchBar').value.toLowerCase();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        document.getElementById('selectItem').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option>' + 
            system.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        document.getElementById('selectEnt').innerHTML = '<option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…ÙˆØ±Ø¯ --</option>' + 
            system.entities.map(e => <option value="${e.n}">${e.n}</option>).join('');

        // Ø§Ù„Ø¬Ø¯ÙˆÙ„
        let rows = "";
        system.items.forEach((item, idx) => {
            if(item.n.toLowerCase().includes(search) || item.c.toLowerCase().includes(search)) {
                let bal = 0;
                system.logs.forEach(l => { if(l.c == item.c) bal += (l.t == 1 ? l.q : -l.q); });
                rows += `<tr>
                    <td>${item.c}</td>
                    <td>${item.n}</td>
                    <td style="color:${bal < 0 ? 'red' : 'green'}">${bal}</td>
                    <td>
                        <button class="btn-gold" onclick="printCard('${item.c}')" style="padding:5px 10px;">ÙƒØ§Ø±ØªØ©</button>
                        ${activeUser.role == 'admin' ? <button onclick="delItem(${idx})" style="background:none; color:red; cursor:pointer;">ğŸ—‘</button> : ''}
                    </td>
                </tr>`;
            }
        });
        document.getElementById('tableBody').innerHTML = rows;
    }

    function process(type) {
        let c = document.getElementById('selectItem').value;
        let q = parseFloat(document.getElementById('docQty').value);
        let d = document.getElementById('docNum').value;
        let e = document.getElementById('selectEnt').value;

        if (c && q && d) {
            system.logs.push({ c, q, t: type, d, e, u: activeUser.name, dt: new Date().toLocaleString() });
            renderUI();
            document.getElementById('docQty').value = ""; document.getElementById('docNum').value = "";
            alert("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        } else {
            alert("âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ (Ø§Ù„ØµÙ†ÙØŒ Ø§Ù„ÙƒÙ…ÙŠØ©ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†)");
        }
    }

    function addItem() {
        let n = document.getElementById('itName').value, c = document.getElementById('itCode').value;
        if(n && c) { system.items.push({n, c}); renderUI(); alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©"); }
    }
    function addStaff() {
        let u = document.getElementById('newStaffU').value, p = document.getElementById('newStaffP').value;
        if(u && p) { system.staff.push({u, p}); renderUI(); alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù"); }
    }
    function addEntity() {
        let n = document.getElementById('entName').value;
        if(n) { system.entities.push({n}); renderUI(); alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ø±Ù"); }
    }
    function delItem(i) { if(confirm("Ø­Ø°Ù Ø§Ù„ØµÙ†Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { system.items.splice(i,1); renderUI(); } }

    function printCard(code) {
        let it = system.items.find(x => x.c == code);
        let logs = system.logs.filter(l => l.c == code);
        let h = `<div style="direction:rtl; font-family:serif; padding:40px; border: 5px solid #c5a059;">
            <h1 style="text-align:center;">Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
            <h2 style="text-align:center; border:none;">ÙƒØ§Ø±ØªØ© Ø­Ø±ÙƒØ© Ø§Ù„ØµÙ†Ù: ${it.n}</h2>
            <hr>
            <table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
                <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø°Ù†</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th></tr></thead>
                <tbody>`;
        let b = 0;
        logs.forEach(l => { b += (l.t == 1 ? l.q : -l.q); h += <tr><td>${l.dt}</td><td>${l.t==1?'ÙˆØ§Ø±Ø¯':'ØµØ±Ù'}</td><td>${l.q}</td><td>${l.d}</td><td>${l.u}</td></tr>; });
        h += </tbody></table><h2 style="border:none;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${b}</h2></div>;
        document.getElementById('printZone').innerHTML = h;
        window.print();
    }
</script>
</body>
</html>
