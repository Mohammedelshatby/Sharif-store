<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ V22</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { background: #000; color: #d4af37; font-family: 'Arial', sans-serif; text-align: center; margin: 0; padding: 10px; }
        .box { border: 2px solid #d4af37; padding: 15px; background: #0a0a0a; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 0 15px rgba(212,175,55,0.1); }
        h1 { margin: 0; font-size: 26px; }
        .status-bar { background: #1a1a1a; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #333; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„ÙŠÙƒÙˆÙ† Ø³Ù‡Ù„ Ø§Ù„Ø¶ØºØ· ÙˆÙ…Ø³ØªØ¬ÙŠØ¨ ÙÙˆØ±Ø§Ù‹ */
        .btn { 
            background: #d4af37; color: #000; padding: 20px 10px; 
            border: 2px solid #fff; border-radius: 12px; font-weight: bold; 
            font-size: 18px; cursor: pointer; margin: 8px 1%; width: 46%;
            display: inline-block; vertical-align: top; -webkit-tap-highlight-color: transparent;
        }
        .btn:active { background: #fff; transform: translateY(2px); }
        
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.98); z-index:99999; padding-top: 20px; overflow-y:auto; }
        .modal-inner { background: #111; border: 2px solid #d4af37; margin: 10px; padding: 20px; border-radius: 15px; }
        
        input, select { width: 100%; padding: 15px; margin: 10px 0; background: #222; color: #fff; border: 1px solid #d4af37; font-size: 18px; border-radius: 8px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; color: #fff; margin-top: 15px; }
        th, td { border: 1px solid #444; padding: 12px; text-align: center; }
        th { background: #d4af37; color: #000; }
        
        .admin-section { display: none; border: 2px dashed red; padding: 15px; margin-top: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h1>Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
    <div class="status-bar">
        <span id="stUser">ğŸ‘¤ Ø§Ù„ÙˆØ¶Ø¹: Ù…ÙˆØ¸Ù</span> | 
        <button onclick="var p=prompt('ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙŠØ±:'); if(p=='2525'){ isMgr=true; document.getElementById('mgrZone').style.display='block'; document.getElementById('stUser').innerHTML='ğŸ‘‘ Ø§Ù„ÙˆØ¶Ø¹: Ù…Ø¯ÙŠØ±'; alert('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„'); }else{alert('Ø®Ø·Ø£');}" style="background:none; border:1px solid #d4af37; color:#d4af37; cursor:pointer; border-radius:4px; padding:2px 10px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
    </div>
    <button class="btn" style="background:#900; color:#fff; width:100px; padding:10px; font-size:14px;" onclick="location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
</div>

<div class="box">
    <button class="btn" onclick="document.getElementById('popItem').style.display='block'">ğŸ“¦ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</button>
    <button class="btn" onclick="document.getElementById('popEnt').style.display='block'">ğŸ‘¥ Ø¹Ù…ÙŠÙ„/Ù…ÙˆØ±Ø¯</button>
    <button class="btn" onclick="mType='ÙˆØ§Ø±Ø¯'; document.getElementById('popMove').style.display='block'; document.getElementById('moveH').innerText='Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ© (ÙˆØ§Ø±Ø¯)'; loadLists();">ğŸ“¥ Ø¥Ø°Ù† Ø¥Ø¶Ø§ÙØ©</button>
    <button class="btn" onclick="mType='ØµØ±Ù'; document.getElementById('popMove').style.display='block'; document.getElementById('moveH').innerText='Ø¥Ø°Ù† ØµØ±Ù (ØµØ§Ø¯Ø±)'; loadLists();">ğŸ“¤ Ø¥Ø°Ù† ØµØ±Ù</button>
    <button class="btn" style="width:95%" onclick="renderInv(); document.getElementById('popInv').style.display='block'">ğŸ“Š Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù† ÙˆØ§Ù„Ø¨Ø­Ø«</button>
</div>

<div id="mgrZone" class="admin-section">
    <h2 style="color:red">âš™ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
    <button class="btn" style="width:95%; background:#fff;" onclick="exportExcel()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Excel)</button>
    <button class="btn" style="width:95%; background:orange;" onclick="showAdminEdit()">âœ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
    <div id="mgrDisplay"></div>
</div>

<div id="popItem" class="modal">
    <div class="modal-inner">
        <h2>ØªÙƒÙˆÙŠØ¯ ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="itN" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
        <input type="text" id="itC" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
        <button class="btn" style="width:100%" onclick="saveIt()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn" style="width:100%; background:#555; color:#fff;" onclick="this.parentElement.parentElement.style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="popEnt" class="modal">
    <div class="modal-inner">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ù…ÙˆØ±Ø¯</h2>
        <select id="enT"><option value="Ù…ÙˆØ±Ø¯">Ù…ÙˆØ±Ø¯</option><option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option></select>
        <input type="text" id="enN" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <button class="btn" style="width:100%" onclick="saveEn()">Ø­ÙØ¸</button>
        <button class="btn" style="width:100%; background:#555; color:#fff;" onclick="this.parentElement.parentElement.style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="popMove" class="modal">
    <div class="modal-inner">
        <h2 id="moveH">Ø­Ø±ÙƒØ©</h2>
        <input type="text" id="moD" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù† Ø§Ù„ÙŠØ¯ÙˆÙŠ">
        <select id="moIt"></select>
        <input type="number" id="moQ" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        <select id="moEn"></select>
        <button class="btn" style="width:100%" onclick="saveMo()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø±ÙƒØ©</button>
        <button class="btn" style="width:100%; background:#555; color:#fff;" onclick="this.parentElement.parentElement.style.display='none'">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="popInv" class="modal">
    <div class="modal-inner">
        <h2>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø±Ø¯</h2>
        <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù..." onkeyup="searchInv(this.value)">
        <div id="invTableBox"></div>
        <button class="btn" style="width:100%; background:red; color:#fff;" onclick="this.parentElement.parentElement.style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    var mType = ""; var isMgr = false;
    var data = JSON.parse(localStorage.getItem('SHARIF_V22')) || { items:[], logs:[], entities:[] };

    function saveIt() {
        var n=document.getElementById('itN').value, c=document.getElementById('itC').value;
        if(n && c){ data.items.push({n:n, c:c}); sync(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); document.getElementById('popItem').style.display='none'; }
    }

    function saveEn() {
        var t=document.getElementById('enT').value, n=document.getElementById('enN').value;
        if(n){ data.entities.push({t:t, n:n}); sync(); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); document.getElementById('popEnt').style.display='none'; }
    }

    function loadLists() {
        document.getElementById('moIt').innerHTML = data.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        var filtered = data.entities.filter(e => (mType==='ÙˆØ§Ø±Ø¯' ? e.t==='Ù…ÙˆØ±Ø¯' : e.t==='Ø¹Ù…ÙŠÙ„'));
        document.getElementById('moEn').innerHTML = filtered.map(e => <option value="${e.n}">${e.n}</option>).join('');
    }

    function saveMo() {
        var d=document.getElementById('moD').value, i=document.getElementById('moIt').value, q=document.getElementById('moQ').value, e=document.getElementById('moEn').value;
        if(d && i && q){
            data.logs.push({id:Date.now(), d:d, i:i, q:parseFloat(q), e:e, t:mType, dt:new Date().toLocaleString('ar-EG')});
            sync(); alert('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„'); document.getElementById('popMove').style.display='none';
        }
    }

    function renderInv() {
        var h = '<table><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th></tr>';
        data.items.forEach(it => {
            var b = 0;
            data.logs.forEach(l => { if(l.i==it.c) b += (l.t=='ÙˆØ§Ø±Ø¯' ? l.q : -l.q); });
            h += <tr><td>${it.n}</td><td style="color:${b<0?'red':'lime'}">${b}</td></tr>;
        });
        document.getElementById('invTableBox').innerHTML = h + '</table>';
    }

    function showAdminEdit() {
        var h = '<h3>ØªØ­ÙƒÙ… Ø§Ù„Ø£ØµÙ†Ø§Ù</h3><table>';
        data.items.forEach((it, idx) => {
            h += <tr><td>${it.n}</td><td><button onclick="data.items.splice(${idx},1);sync();showAdminEdit();" style="color:red">Ø­Ø°Ù</button></td></tr>;
        });
        document.getElementById('mgrDisplay').innerHTML = h + '</table>';
    }

    function sync() { localStorage.setItem('SHARIF_V22', JSON.stringify(data)); }
    
    function exportExcel() {
        var ws = XLSX.utils.json_to_sheet(data.logs);
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Logs");
        XLSX.writeFile(wb, "Sharif_Report.xlsx");
    }
</script>
</body>
</html>
