<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMS V6 | Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</title>
    <style>
        :root { --main: #1e293b; --accent: #2563eb; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; direction: rtl; }
        .container { max-width: 1100px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header { background: var(--main); color: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; color: white; transition: 0.3s; }
        .btn-blue { background: var(--accent); }
        .btn-green { background: #10b981; width: 100%; }
        .btn-red { background: #ef4444; }
        .admin-box { display: none; border: 2px solid var(--accent); padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: center; }
        th { background: #f1f5f9; color: var(--main); }
        @media print { .no-print { display: none !important; } .print-area { display: block !important; } }
        .print-area { display: none; }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="header">
        <div>
            <h1 style="margin:0;">Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø´Ø±ÙŠÙ Ø§Ù„Ø¬Ù†Ø¯ÙŠ</h1>
            <p id="userLabel" style="margin:5px 0 0 0; color:#cbd5e1;">Ø§Ù„Ø­Ø§Ù„Ø©: Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù†</p>
        </div>
        <div id="authArea">
            <button class="btn-blue" id="loginBtn" onclick="openLogin()">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button class="btn-red" id="logoutBtn" style="display:none;" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div id="adminPanel" class="admin-box no-print">
        <h3 style="margin-top:0;">âš™ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
                <h4>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h4>
                <input type="text" id="itName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
                <input type="text" id="itCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù">
                <button class="btn-green" onclick="addItem()">+ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
            </div>
            <div class="card">
                <h4>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h4>
                <input type="text" id="stName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
                <input type="text" id="stPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button class="btn-blue" style="width:100%" onclick="addStaff()">+ Ø­ÙØ¸ Ù…ÙˆØ¸Ù</button>
            </div>
            <div class="card">
                <h4>Ø¹Ù…ÙŠÙ„ / Ù…ÙˆØ±Ø¯</h4>
                <input type="text" id="enName" placeholder="Ø§Ù„Ø§Ø³Ù…">
                <select id="enType"><option value="Ø¹Ù…ÙŠÙ„">Ø¹Ù…ÙŠÙ„</option><option value="Ù…ÙˆØ±Ø¯">Ù…ÙˆØ±Ø¯</option></select>
                <button class="btn-green" onclick="addEntity()" style="background:#6366f1;">+ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ”ƒ ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© (ÙˆØ§Ø±Ø¯ / ØµØ±Ù)</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <select id="selItem"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù --</option></select>
            <input type="text" id="docId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø°Ù†">
            <input type="number" id="qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <select id="selEnt"><option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„ / Ø§Ù„Ù…ÙˆØ±Ø¯ --</option></select>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button onclick="saveLog('ÙˆØ§Ø±Ø¯')" style="flex:1; background:#10b981;">ÙˆØ§Ø±Ø¯ (+)</button>
            <button onclick="saveLog('ØµØ±Ù')" style="flex:1; background:#ef4444;">ØµØ±Ù (-)</button>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>ğŸ“Š Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
            <div style="display:flex; gap:10px;">
                <input type="text" id="search" placeholder="Ø¨Ø­Ø«..." onkeyup="refreshUI()" style="width:200px; margin:0;">
                <button onclick="window.print()" style="background:#64748b;">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø±Ø¯</button>
            </div>
        </div>
        <table>
            <thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø£Ø¯ÙˆØ§Øª</th></tr></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<div id="printArea" class="print-area"></div>

<script>
    let db = JSON.parse(localStorage.getItem('SHARIF_V6')) || { items:[], logs:[], staff:[], entities:[], adminPass:"123" };
    let activeUser = null;

    function openLogin() {
        let u = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:");
        let p = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        if(u === "admin" && p === db.adminPass) { activeUser = {n:"Ø§Ù„Ù…Ø¯ÙŠØ±", r:"admin"}; }
        else { 
            let s = db.staff.find(x => x.u === u && x.p === p);
            if(s) activeUser = {n:u, r:"staff"};
        }

        if(activeUser) {
            document.getElementById('loginBtn').style.display = "none";
            document.getElementById('logoutBtn').style.display = "inline-block";
            document.getElementById('userLabel').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + activeUser.n;
            document.getElementById('userLabel').style.color = "#10b981";
            if(activeUser.r === "admin") document.getElementById('adminPanel').style.display = "block";
            refreshUI();
        } else { alert("Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„!"); }
    }

    function refreshUI() {
        localStorage.setItem('SHARIF_V6', JSON.stringify(db));
        let q = document.getElementById('search').value.toLowerCase();
        document.getElementById('selItem').innerHTML = '<option value="">-- Ø§Ø®ØªØ± ØµÙ†Ù --</option>' + db.items.map(i => <option value="${i.c}">${i.n}</option>).join('');
        document.getElementById('selEnt').innerHTML = '<option value="">-- Ø§Ù„Ø¹Ù…ÙŠÙ„ / Ø§Ù„Ù…ÙˆØ±Ø¯ --</option>' + db.entities.map(e => <option value="${e.n}">${e.n}</option>).join('');
        
        let html = "";
        db.items.forEach((it, idx) => {
            if(it.n.toLowerCase().includes(q) || it.c.toLowerCase().includes(q)) {
                let bal = 0; db.logs.forEach(l => { if(l.c==it.c) bal += (l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); });
                html += `<tr><td>${it.c}</td><td><b>${it.n}</b></td><td>${bal}</td>
                <td><button onclick="printCard('${it.c}')" style="background:var(--accent); padding:5px 10px;">ÙƒØ§Ø±ØªØ©</button>
                ${activeUser?.r=='admin'?<button onclick="delI(${idx})" style="color:red; background:none; font-size:18px;">ğŸ—‘</button>:''}</td></tr>`;
            }
        });
        document.getElementById('tbody').innerHTML = html;
    }

    function saveLog(type) {
        if(!activeUser) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!");
        let c=document.getElementById('selItem').value, q=parseFloat(document.getElementById('qty').value), d=document.getElementById('docId').value, e=document.getElementById('selEnt').value;
        if(c && q && d) { db.logs.push({c,q,t:type,d,e,u:activeUser.n,dt:new Date().toLocaleString()}); refreshUI(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); }
        else alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    }

    function addItem() { let n=document.getElementById('itName').value, c=document.getElementById('itCode').value; if(n&&c){db.items.push({n,c}); refreshUI(); alert("ØªÙ…");} }
    function addStaff() { let u=document.getElementById('stName').value, p=document.getElementById('stPass').value; if(u&&p){db.staff.push({u,p}); refreshUI(); alert("ØªÙ…");} }
    function addEntity() { let n=document.getElementById('enName').value, t=document.getElementById('enType').value; if(n){db.entities.push({n,t}); refreshUI(); alert("ØªÙ…");} }
    function delI(i) { if(confirm("Ø­Ø°ÙØŸ")){db.items.splice(i,1); refreshUI();} }

    function printCard(code) {
        let it = db.items.find(x=>x.c==code);
        let logs = db.logs.filter(l=>l.c==code);
        let h = `<div style="direction:rtl; padding:20px; font-family:sans-serif;"><h2>ØªÙ‚Ø±ÙŠØ± ÙƒØ§Ø±ØªØ© ØµÙ†Ù: ${it.n}</h2><table border="1" style="width:100%; border-collapse:collapse; text-align:center;">
        <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø°Ù†</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th></tr></thead><tbody>`;
        let b=0; logs.forEach(l=>{ b+=(l.t=='ÙˆØ§Ø±Ø¯'?l.q:-l.q); h+=<tr><td>${l.dt}</td><td>${l.t}</td><td>${l.q}</td><td>${l.d}</td><td>${l.u}</td></tr>; });
        h += </tbody></table><h3>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${b}</h3></div>;
        document.getElementById('printArea').innerHTML = h; window.print();
    }
    refreshUI();
</script>
</body>
</html>
